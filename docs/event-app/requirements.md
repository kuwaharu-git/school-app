# Event App - 要件定義書

作成日: 2025-01-01
作成者: GitHub Copilot（自動生成）

## 1. 概要
学校アプリケーションにイベント管理機能を追加する。学生や教職員がイベントを作成・参加・管理できるようにし、日時や参加者の情報を効率的に管理する。

## 2. 目的
- 学校内でのイベント（勉強会、セミナー、サークル活動等）の情報を一元管理する
- 参加者の管理を効率化し、参加状況を可視化する
- イベントの重複や競合を防ぎ、スケジュール調整を支援する
- 参加者同士のコミュニケーションを促進する

## 3. 利用者（ユーザ役割）
- 登録ユーザ（Authenticated User）
  - イベントを作成、編集、削除できる（自身が作成したもの）
  - 他のユーザが作成したイベントに参加・キャンセルできる
  - イベント詳細を閲覧し、参加者リストを確認できる
  - イベントにコメントを投稿できる
- ゲスト（未ログインユーザ）
  - 公開イベントの一覧、詳細を閲覧できる
  - イベント作成や参加登録はできない
- 管理者（Admin User）
  - 全てのイベントを編集・削除できる
  - イベント統計情報を閲覧できる

## 4. 機能要件
### 4.1 イベント（Event）
- フィールド
  - id, title, description, organizer(User FK), start_datetime, end_datetime, location, max_participants, tags, is_public, created_at, updated_at, is_cancelled
- 制約
  - 日時は必須（start_datetime < end_datetime）
  - 最大参加者数は0以上（0=無制限）
  - 場所は任意（オンラインイベント対応）
- 権限
  - 作成/編集/削除は認証済みユーザかつorganizer、または管理者
  - 公開設定により閲覧権限を制御

### 4.2 参加者管理（EventParticipant）
- フィールド
  - id, event(FK), participant(User FK), status, registered_at, attended_at, comment
- ステータス
  - registered: 参加登録済み
  - cancelled: キャンセル済み
  - attended: 参加済み
  - absent: 欠席
- 機能
  - 登録ユーザのみ参加登録可能
  - 最大参加者数制限のチェック
  - 主催者による出席確認機能

### 4.3 イベントコメント（EventComment）
- フィールド
  - id, event(FK), author(User FK), content, created_at, updated_at
- 機能
  - 登録ユーザのみコメント投稿可能
  - 主催者と管理者はコメント削除可能
  - 参加者同士の情報共有やQ&A

### 4.4 通知機能
- イベント作成時に関連ユーザへの通知
- 参加登録時に主催者への通知
- イベント変更時の参加者への通知
- リマインダー通知（開始前24時間、1時間前）

## 5. API設計（概要）
- GET /api/events/ — イベント一覧（フィルタ: date, tag, location, organizer）
- POST /api/events/ — イベント作成（認証必須）
- GET /api/events/{id}/ — イベント詳細（参加者リスト含む）
- PATCH /api/events/{id}/ — イベント編集（organizerまたは管理者のみ）
- DELETE /api/events/{id}/ — イベント削除（organizerまたは管理者のみ）
- POST /api/events/{id}/join/ — イベント参加登録（認証必須）
- DELETE /api/events/{id}/leave/ — イベント参加キャンセル（認証必須）
- POST /api/events/{id}/comments/ — コメント投稿（認証必須）
- GET /api/events/{id}/comments/ — コメント一覧
- PATCH /api/events/{id}/participants/{user_id}/ — 出席状況更新（主催者のみ）

## 6. DBモデル（概略）
- Event: イベント基本情報
- EventParticipant: 参加者情報（中間テーブル）
- EventComment: イベントコメント
- EventTag: タグ情報（多対多関係用）
- EventNotification: 通知ログ（任意）

## 7. フロントエンド（概要）
### 7.1 イベント一覧ページ
- カレンダービュー・リストビューの切り替え
- 日付・タグ・場所によるフィルタリング
- 検索機能（タイトル・説明文）
- ページネーション

### 7.2 イベント詳細ページ
- イベント情報の表示
- 参加登録・キャンセルボタン
- 参加者リスト（公開設定に応じて）
- コメント欄

### 7.3 イベント作成・編集ページ
- フォームバリデーション（日時の整合性チェック）
- リアルタイム参加者数確認
- プレビュー機能

### 7.4 マイイベント管理ページ
- 作成したイベントの管理
- 参加予定イベントの確認
- 出席状況の管理

## 8. セキュリティとプライバシー
- イベント作成・参加は認証必須
- 非公開イベントは招待されたユーザのみ閲覧可能
- 個人情報（参加者リスト）の表示制御
- CSRF保護、SQLインジェクション対策

## 9. 非機能要件
- レスポンス: イベント一覧は50件/ページ
- 可用性: カレンダーデータのキャッシュ化
- 拡張性: 繰り返しイベント（月次・週次）対応準備
- 通知: メール・プッシュ通知の統合準備

## 10. 受け入れ基準（例）
- [ ] ユーザはイベントを作成できる
- [ ] 他のユーザはイベントに参加登録できる
- [ ] 最大参加者数の制限が正しく動作する
- [ ] 日時の重複チェックが機能する
- [ ] 主催者は参加者の出席状況を管理できる
- [ ] ゲストは公開イベントを閲覧できる
- [ ] 通知機能が正常に動作する

## 11. 実装の進め方（提案タスク）
1. DBモデルとマイグレーション作成（Event, EventParticipant, EventComment）
2. シリアライザとViewSet(API)作成
3. 権限クラスの実装（認証・認可）
4. フロントエンドのルーティングとUI（一覧・詳細・作成・参加管理）
5. 通知機能の実装
6. テスト作成（単体・統合）
7. ドキュメントとデプロイ準備

## 12. 補足
- 既存のユーザ認証周り（JWT/セッション等）はそのまま使用する想定
- カレンダーライブラリ（FullCalendar等）の統合を検討
- 将来的にはZoomやGoogle Meet等の外部サービス連携を検討

---
以上。実装を開始したい場合は、どの層（バックエンド／フロントエンド／両方）から着手するか指示してください。