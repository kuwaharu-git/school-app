# Review App - 要件定義書

作成日: 2025-08-19
作成者: GitHub Copilot（自動生成）

## 1. 概要
学生が自身の制作物（GitHubリポジトリや公開URL）を登録・公開し、他の生徒がレビュー（コメント、評価）できる機能を提供するアプリケーションを追加する。既存のユーザ認証機能はそのまま利用する。

## 2. 目的
- 生徒同士のアウトプット共有とフィードバックを促進する
- 公開ポートフォリオ的なアーカイブを簡易に残す
- ゲストでもレビュー一覧とレビュー内容を参照できることで外部からの閲覧性を確保する

## 3. 利用者（ユーザ役割）
- 登録ユーザ（Authenticated User）
  - 制作物を登録、編集、削除できる（自身のもの）
  - 制作物にレビュー（コメント、星評価など）を投稿できる
  - レビューページでユーザ名をクリックするとポップアップでそのユーザのプロフィール情報を見ることができる（ただし表示する項目は限定）
- ゲスト（未ログインユーザ）
  - 制作物一覧、詳細、レビューを閲覧できる
  - レビュー投稿や制作物登録はできない
  - ユーザのプロフィールページ（詳細プロフィール）にはアクセスできない（プロフィールAPIは認証必須／非表示）
- 管理者（Admin）
  - 不適切な制作物・レビューの削除、ユーザのモデレーション

## 4. 機能要件
### 4.1 制作物（Project）
- フィールド
  - id, title, description, author(User FK), repository_url (GitHub等), live_url (任意), tags, created_at, updated_at, is_public
- 制約
  - URLはバリデーション（http / https）、任意でリッチメタ（OGP）を取得してサムネイル等を表示
- 権限
  - 作成/編集/削除は認証済みユーザかつauthorのみ
  - 非公開設定は将来的に検討（今回は公開がデフォルト）

### 4.2 レビュー（Review）
- フィールド
  - id, project (FK), reviewer (User FK), rating (1-5), comment, created_at, updated_at
- 機能
  - 登録ユーザのみレビュー投稿可能
  - ゲストはレビューの参照のみ
  - 同一ユーザが同一制作物に対して複数レビューを投稿できるかは要検討（初期は1投稿で更新可能）

### 4.3 プロフィール表示（ポップアップ）
- 登録ユーザがレビューページ上でユーザ名をクリックすると小さなモーダル/ポップアップを表示
- 表示項目の例（公開可能な範囲に限定）
  - 表示名、ユーザ名（@handle）、簡単な自己紹介、公開されている制作物数、SNSリンク（任意）
- 注意: ゲストはポップアップを表示できるが、詳しいプロフィール（メール、非公開情報など）やプロフィールページへの遷移は不可にする

### 4.4 公開とアクセス制御
- 制作物一覧・詳細・レビューの閲覧は認証不要（ゲスト可）
- プロフィールの詳細APIは認証が必要にする（GET /api/users/{id}/public は公開情報のみ返すエンドポイントとして設計）
- 重要: ゲストがプロフィールページへ直接アクセスしても、非公開情報は返さないことを保証する

## 5. API設計（概要）
- GET /api/reviews/projects/ — 制作物一覧（フィルタ: tag, author, search）
- POST /api/reviews/projects/ — 制作物登録（認証必須）
- GET /api/reviews/projects/{id}/ — 制作物詳細（レビューを含む）
- PATCH /api/reviews/projects/{id}/ — 編集（authorのみ）
- DELETE /api/reviews/projects/{id}/ — 削除（authorまたはadmin）
- POST /api/reviews/projects/{id}/reviews/ — レビュー投稿（認証必須）
- GET /api/reviews/projects/{id}/reviews/ — レビュー一覧（ゲスト可）
- GET /api/users/{id}/public/ — 公開プロフィール（ゲスト可、返す項目を制限）

（実装はDjango REST Frameworkを想定。シリアライザで出力フィールドを制御）

## 6. DBモデル（概略）
- Project (models.Model)
  - author = ForeignKey(User, on_delete=CASCADE)
  - title = CharField
  - description = TextField
  - repository_url = URLField
  - live_url = URLField(null=True, blank=True)
  - tags = ManyToMany(Tag) or CharField(comma separated)
- Review
  - project = ForeignKey(Project, related_name='reviews')
  - reviewer = ForeignKey(User, on_delete=SET_NULL, null=True)
  - rating = IntegerField
  - comment = TextField

## 7. フロントエンド（概要）
- ページ
  - /projects/ — 一覧ページ（カード形式）
  - /projects/{id}/ — 詳細ページ（上部にタイトル・リンク・OGP、下部にレビュー一覧・レビュー投稿フォーム）
- UI要素
  - レビュー投稿フォーム（認証が必要な場合はログイン促進ボタン）
  - ユーザ名はクリック可能（登録ユーザが見るとモーダルでユーザ情報表示）
  - ゲスト向けビヘイビア: ユーザ名クリックで最小限の公開情報のみ表示、非公開フィールドは表示しない

## 8. セキュリティとプライバシー
- ユーザの個人情報（メールアドレス、設定、プライベートリンク等）はAPI上で露出しない
- レビューや制作物の投稿はCSRF/認証チェックを必須にする
- 外部URLの表示はサニタイズし、サーバサイドでのURL検証を行う

## 9. 非機能要件
- レスポンス: 一覧ページはページネーションを導入（例: 20件/ページ）
- 可用性: 画像サムネイルやOGPの保存はキャッシュ化
- ロギング: 投稿・削除・編集の監査ログを残す（管理者のため）

## 10. 受け入れ基準（例）
- 登録ユーザが制作物を登録できること
- 登録ユーザがレビューを投稿できること
- ゲストが制作物一覧・詳細・レビューを閲覧できること
- ゲストがユーザのフルプロフィールにアクセスできないこと（APIで検証）
- 登録ユーザがレビューページでユーザ名をクリックしてポップアップで公開プロフィールを確認できること

## 11. 実装の進め方（提案タスク）
1. DBモデルとマイグレーション作成（Project, Review）
2. シリアライザとViewSet(API)作成
3. 権限クラスの実装（認証要/ゲスト許可のルート分離）
4. フロントエンドのルーティングとUI（一覧・詳細・レビュー投稿・ポップアップ）
5. テスト作成（単体・統合）
6. ドキュメントとデプロイ準備

## 12. 補足
- 既存のユーザ認証周り（JWT/セッション等）はそのまま使用する想定。APIの認可ロジックは既存の仕組みに合わせて実装する。
- Serena生成ファイルを参照してスタイル・認証フローを合わせること（既存プロジェクト構成に準拠）

---
以上。実装を開始したい場合は、どの層（バックエンド／フロントエンド／両方）から着手するか指示してください。
